<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Yalv by marsinvasion</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <a href="http://github.com/marsinvasion/yalv" class="github-corner">
    
    <section class="page-header">
    <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#151513; color:#fff; position: absolute; top: 0; border: 0; right: 0;"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a><style>.github-corner:hover .octo-arm{animation:octocat-wave 560ms ease-in-out}@keyframes octocat-wave{0%,100%{transform:rotate(0)}20%,60%{transform:rotate(-25deg)}40%,80%{transform:rotate(10deg)}}@media (max-width:500px){.github-corner:hover .octo-arm{animation:none}.github-corner .octo-arm{animation:octocat-wave 560ms ease-in-out}}</style>
      <h1 class="project-name">Yalv</h1>
      <h2 class="project-tagline">Yet Another Log Viewer</h2>
      <a href="https://github.com/marsinvasion/yalv" class="btn">View on GitHub</a>
    </section>

    <section class="main-content">
      <h1>
<a id="yalv" class="anchor" href="#yalv" aria-hidden="true"><span class="octicon octicon-link"></span></a>YALV</h1>

<p>Yet Another Log Viewer</p>

<p>YALV helps you avoid the pain of manually tracing requests through logs. It requires an entering and exiting log entry based on which it calculates the time required for execution and matches against the server metrics like server memory used, memory free, load average.</p>

<iframe width="800" height="600" src="https://www.youtube.com/embed/INgIQcOwZ2M" frameborder="0" allowfullscreen></iframe>

<h2>
<a id="getting-started" class="anchor" href="#getting-started" aria-hidden="true"><span class="octicon octicon-link"></span></a>Getting Started</h2>

<ul>
<li><p>Clone project</p></li>
<li><p>Install dependencies</p></li>
</ul>

<pre><code>npm install
</code></pre>

<p>YALV has two main components on the server side. A udp server listens for logs being sent and stores it in mongodb. A bash script tails logs and sends it to the udp server.</p>

<p>Deploy the following on each server thats generating logs.</p>

<ul>
<li>Start the udp server on all servers. This listens for messages on port 5201</li>
</ul>

<pre><code>node server/udp.js
</code></pre>

<ul>
<li>Start live monitoring script</li>
</ul>

<pre><code>./monitor/tail.sh

or

./monitor/tail.sh /var/log/app.log pid 5201
</code></pre>

<p>In the first scenario it looks for app.log in the current working directory. It tails app.log and if it finds a string with pid in the log file it pushes to the udp server on port 5201.</p>

<p>The second option lets you give the location of the log file, custom string to look for in each log entry and the udp port.</p>

<p>This reads each line and matches the entry/exit for a particular request. It also adds server snapshot at that moment in time, giving you the corresponding server load, RAM used, RAM free.</p>

<ul>
<li>Load historical logs</li>
</ul>

<pre><code>./monitor/loadLog.sh
</code></pre>

<p>It takes the same arguments as tail.sh. One disadvantage of using loading historical logs is you dont get server memory/load snapshot at the time of log generation. The memory/server load snapshots would be the server information at the time of file reading.</p>

<ul>
<li>
<p>Mongodb</p>

<p>The service uses mongodb for the backend.
Mongodb location is configured in db/db.js. Change url variable to your location of mongodb instance
If you would like to replace mongodb with another db, replace the functions in db/db.js with the equivalent for your db.</p>
</li>
</ul>

<h2>
<a id="supported-platforms" class="anchor" href="#supported-platforms" aria-hidden="true"><span class="octicon octicon-link"></span></a>Supported Platforms</h2>

<ul>
<li>Linux/Mac</li>
<li>Git bash on windows should work fine. (Load average will be [0,0,0] as that concept doesn't exist on windows)</li>
</ul>

<h2>
<a id="generating-logs" class="anchor" href="#generating-logs" aria-hidden="true"><span class="octicon octicon-link"></span></a>Generating logs</h2>

<ul>
<li>Logs are generally generated by your application. However for testing purposes, you can generate dummy logs.</li>
</ul>

<pre><code>node jobs.js
</code></pre>

<p>This will generate logs in app.log in your current working directory. It uses bunyan and node cron jobs to generate logs.
Each log entry will look like </p>

<pre><code>{"name":"app","hostname":"L-SFM4142Q32","pid":8912,"level":30,"type":"entering","request":"2df4b3e3093da57548e0","api":"service","func":"calculate","msg":"","time":"2015-09-04T18:28:00.917Z","v":0}

...

{"name":"app","hostname":"L-SFM4142Q32","pid":8912,"level":30,"type":"exiting","request":"2df4b3e3093da57548e0","api":"service","func":"calculate","msg":"","time":"2015-09-04T18:28:01.379Z","v":0}
</code></pre>

<p>The service looks for type=entering,type=exiting and respective timestamps to match requests on same request,web server and func values.</p>

<p>If your  application doesn't generate json logs, you can modify either bash script or udp server to change your log string to json formatted string in the above format.</p>

<p>Looped calls to a function are all captured. Individual looped request are shown under all requests while the averaged out response times are shown in the other graphs.</p>

<h2>
<a id="ui" class="anchor" href="#ui" aria-hidden="true"><span class="octicon octicon-link"></span></a>UI</h2>

<p>To check out the graphical representation of your logs check out <a href="https://github.com/marsinvasion/yalv-ui">YALV-UI</a></p>

<h2>
<a id="dependencies" class="anchor" href="#dependencies" aria-hidden="true"><span class="octicon octicon-link"></span></a>Dependencies</h2>

<ul>
<li>
<a href="https://github.com/trentm/node-bunyan">bunyan</a>: a JSON logging library for node.js services</li>
<li>
<a href="https://github.com/marsinvasion/node-cron-jobs">node-cron-jobs</a>: Schedules cron like jobs</li>
<li>
<a href="https://github.com/strongloop/express">express</a>: Fast, unopinionated, minimalist web framework</li>
<li>
<a href="https://github.com/ericf/express-handlebars">express-handlebars</a>: A Handlebars view engine for Express which doesn't suck.</li>
<li>
<a href="https://github.com/mongodb/node-mongodb-native">mongodb</a>: A node.js driver for MongoDB</li>
</ul>

<h2>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h2>

<p><a href="LICENSE">MIT</a></p>

<p>Anoop Kulkarni (<a href="http://anoopkulkarni.com">http://anoopkulkarni.com</a>, <a href="https://tweetcareers.com">https://tweetcareers.com</a>,  <a href="https://newsp.in">https://newsp.in</a>)</p>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/marsinvasion/yalv">Yalv</a> is maintained by <a href="https://github.com/marsinvasion">marsinvasion</a>.</span>

        </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-68122912-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
